# Лабораторная работа №4. Тема: "Мандатное управление доступом"
Цель работы
----------
познакомиться с терминами мандатного управления доступом в AstraLinux;

организовать совместную работу пользователей с файлами на разных уровнях конфиденциальности;

изучить основные инструменты управления мандатным доступом;

получить навык поиска информации в документации.

Оборудование, ПО:
----------

Виртуальная машина или компьютер под управлением ОС AstraLinux 1.7 в режиме защищенности "Воронеж" или выше.

Ход работы:
----------

# Начнем с терминологии.

Перед тем, как начать  работу с мандатным уровнем доступа необходимо хорошо понимать компоненты и термины данной системы.

Обратимся к основной документации на сайте [wiki.astralinux.ru](https://wiki.astralinux.ru/pages/viewpage.action?pageId=153486002)

В механизме мандатного управления доступом определены следующие термины:

- **субъект мандатного доступа** — тот, кто выполняет операции, подлежащие мандатному контролю (пользователь или процесс);

- **сущность (объект) мандатного доступа** — то, с чем выполняются операции, подлежащие мандатному контролю (файл, каталог и т.д.);

- **контейнер** — структурированная сущность доступа, т.е. сущность (каталог ФС), которая может содержать другие сущности доступа (каталоги или файлы).

Сущностям и субъектам присваиваются следующие мандатные атрибуты:

- **иерархический уровень конфиденциальности (уровень конфиденциальности)** — определяет степень секретности документа и соответствующий уровень доступа к этому документу, назначенный персоналу (субъекту). Субъекту с определенным уровнем конфиденциальности разрешено читать только документы с таким же уровнем конфиденциальности или ниже и запрещено читать документы с более высоким уровнем конфиденциальности. А также персоналу с более высоким уровнем конфиденциальности запрещено передавать (преднамеренно или случайно) документы высокого уровня конфиденциальности персоналу с более низким уровнем конфиденциальности;

- **неиерархическая категория конфиденциальности (категории конфиденциальности)** — разделение по категориям конфиденциальности. Персонал, работающий с первой категорией конфиденциальности, имеет соответствующую категорию конфиденциальности. При этом, не имея вторую категорию конфиденциальности, персонал не может иметь доступ к материалам второй категории конфиденциальности, а также не может передавать материалы первой категории конфиденциальности персоналу, не имеющему первую категорию конфиденциальности. Доступ может быть предоставлен одновременно к нескольким категориям конфиденциальности;

- **уровень целостности (неиерархический уровень целостности и иерархический (линейный) уровень целостности)** — субъект, работающий на некотором уровне целостности, может записывать (изменять) только сущности своего или более низкого уровня целостности. Иерархический уровень целостности в ОС зарезервирован, и на уровне пользователя не поддерживается его использование;

- **дополнительные мандатные атрибуты управления доступом** — являются необязательными атрибутами и позволяют уточнять или изменять правила мандатного доступа для отдельных контейнеров, субъектов или сущностей.

Путем использования уровней и категорий конфиденциальности обеспечивается защита от несанкционированного доступа к информации в части:

1. невозможности прочитать информацию, к которой не предоставлен доступ:
  * нижним уровням конфиденциальности запрещено читать информацию с верхних уровней конфиденциальности;
  * всем запрещено читать информацию, на которую нет разрешенной категории конфиденциальности;
2. невозможности передать информацию тому, кому не предоставлен доступ:
  * верхним уровням конфиденциальности запрещено записывать свою информацию на нижние уровни конфиденциальности;
  * всем запрещено передавать информацию тем, у кого нет соответствующей категории конфиденциальности.

# А зачем это нужно?

Использование мандатного контроля целостности усиливает общую безопасность вашей ОС, повышая её устойчивость от запуска вредоносного кода на системе. Также, данная система может предотвратить возможные проблемы даже при "атаках нулевого дня" - уязвимостях кода в различных программмах и приложениях, о которых выяснили злоумышленники раньше, чем разработчики смогли предоставить какие-то "патчи" безопасности.

Мандатная система реализует механизм, при котором в случае если вредоносным скриптом были получены права администратора, он всё равно не сможет нанести ущерб информации на вашем ПК.

# А как это выглядит?

Перед практикой, давайте познакомимся с тем, как выглядит настроенный мандатный контроль доступа.
Войдем в систему под пользователем, который был создан при первоначальной установке системы. По-умолчанию, он имеет в системе наивысшие привилегии, так как входит в группу astra-admin. Если вы не знаете какой пользователь у вас есть, можете сделать его самостоятельно и  добавить его в группу astra-admin.

В нашем примере пользователь ladmin.

![Картинка](./Screen1.png)

Как вы можете заметить, вход в систему уже совсем не похож на классический. Система спрашивает под каким режимом целостности входить в систему (с данным понятием мы уже знакомились в первой лабораторной работе).

Войдем в систему под высоким уровнем доступа.


![Картинка](./Screen2.png)

Вы наверняка уже видели данный рабочий стол. Яркий красный цвет указывает нам, что мы попали в систему с привилегиями администратора, иногда на профессиональном жаргоне это называют "красным режимом", но правильнее будет назвать данный режим - режим высокого контроля целостности файлов.

Попробуем зайти в низкий уровень целостности?

![Картинка](./Screen3.png)

В этом режиме (на жарг. "синий режим") наш пользователь не имеет привилегий на изменение адреса или установку пакетов, это стандартный режим работы пользователя с ограниченным функционалом, в нём можно запускать офисные программы, открывать браузер и выполнять основные рабочие задачи с компьютером. Это низкий уровень целостности.

Откроем командную строку и введем "id"

```console
id
```

![Картинка](./Screen4.png)

Обратите внимание, наш пользователь входит в группу astra-admin. Помните, эта группа позволяет всем её членам выполнять управление всей системой!

Давайте зайдем под пользователем "root"

```console
sudo su -
```

![Картинка](./Screen5.png)

Вход успешно прошел, неужели мы так просто обошли систему безопасности?

Попробуем сделать что-нибудь деструктивное, например, записать пару строчек в файл /etc/hosts (достаточно примитивная операция для некоторых "зловредов").

![Картинка](./Screen6.png)

Как можно заметить, даже с повышенными до пользователя root привилегиями изменить что-то в данном файле не получится!

А если, например, мы попробуем остановить какой-то процесс?

![Картинка](./Screen7.png)

Также неудача! Мандатный контроль целостности во всей красе!

# Какие проблемы решает МКЦ?

Помните, что с дискреционными правами доступа каждый пользователь может назначить на свой файл любые права доступа для других пользователей и групп?

Но ведь пользователи - это люди, которые могут случайно допустить ошибку при настройке прав доступа, а это уже может привести к потере данных.

МКЦ же может назначать на файл уровень секретности (вспомните нашу первую лабораторную работу, там активно обсуждался вопрос грифов секретности), а также назначать категории.

Вспомним выдержку из текста первой лабораторной работы:


Представим, что у нас есть две категории "Яблоки" и "Апельсины". Мы наделили персонал, с уровнем доступа "Секретно"", полномочиями работать только с документами категории "Яблоки". Обращаться к документами категории "Апельсины", с тем же уровнем доступа "Секретно", данный персонал не сможет, ровно также как и передавать данные о документах "Яблоки" тем пользователям, кто работает с "Апельсинами". При этом, вероятно нам нужно дать универсальный доступ пользователю "Начальник", который может работать с документами любых категорий.

Давайте посмотрим как это выглядит в операционой системе, для этого создайте через графический интерфейс файл и перейдите в его свойства:


![Картинка](./Screen8.png)



















# Дополнительная информация:
1) Немного про SUID, SGID и Sticky-Bit [Ссылка](https://ruvds.com/ru/helpcenter/suid-sgid-sticky-bit-linux/)
2) Немного про ACL в Linux [Ссылка](https://wiki.archlinux.org/title/Access_Control_Lists_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9))
3) Документация на chattr [Ссылка](https://www.opennet.ru/man.shtml?topic=chattr&category=1&russian=0)
